<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cqupt.dormitory.model.ExcelInfo">
	<resultMap type="com.cqupt.dormitory.model.ExcelInfo" id="excelResult">
		<id property="id" column="excel_id"/>
		<result property="name" column="excel_name"/>
		<result property="path" column="excel_path"/>
		
		<association property="approvedAdmin" column="approved_admin_id" resultMap="adminResult"/>
		<association property="submitTeacher" column="submit_teacher_id" resultMap="teacherResult"/>
	</resultMap>
	
	<!-- 添加Excel信息 -->
	<insert id="addExcel" parameterType="com.cqupt.dormitory.model.ExcelInfo">
		INSERT INTO `excel`(
			`excel_name`, `excel_path`, `submit_teacher_id`, `approved_admin_id`, `status`
		) VALUES (
			#{name}, #{path}, #{submitTeacher.id,jdbcType=INTEGER}, #{approvedAdmin.id,jdbcType=INTEGER}, #{status,jdbcType=INTEGER}
		)
	</insert>
	
	<!-- 根据id删除excel信息 -->
	<delete id="deleteExcelById" parameterType="list">
		DELETE FROM `excel` WHERE `excel_id` IN (
			<foreach collection="list" item="l" separator=",">
				#{l,jdbcType=INTEGER}
			</foreach>
		)
	</delete>
	
	<!-- 查找所有的Excel信息 -->
	<select id="findAllExcel" resultMap="excelResult">
		SELECT * FROM `excel` e
			LEFT JOIN `teacher` t ON e.`submit_teacher_id` = t.`teacher_id`
			LEFT JOIN `admin` a ON e.`approved_admin_id` = a.`admin_id`
	</select>
	
	<!-- 根据教工号查找所提交的Excel -->
	<select id="findExcelByTecNum" parameterType="String" resultMap="excelResult">
		 SELECT * FROM `excel` e
			LEFT JOIN `teacher` t ON e.`submit_teacher_id` = t.`teacher_id`
			LEFT JOIN `admin` a ON e.`approved_admin_id` = a.`admin_id`
			WHERE e.`submit_teacher_id` = #{tecNum}
	</select>
</mapper>