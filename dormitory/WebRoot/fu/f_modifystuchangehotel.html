<div class="right_top btm">
  <div class="rheader"><span class="pageName"><b>调整学生住宿调配</b></span><span class="shuoming">您可以修改学生住宿调配情况</span></div>
</div>
<div class="right_contain">
       <div class="editor" style="float:left;width:700px">
            <p>请上传您调整后的寝室调配情况:</p>
            <form id="form1" method="post" enctype="multipart/form-data" action="excel/addExcel.do" onsubmit="check()">
                 <input name="file" type="file" size="35" onchange="fileChange(this);">
                 <input name="submit" type="submit" class="btn_grey" value="提交">
	        </form>
      </div>
      <div class="result" style="float:left;margin-top:10px;width:700px">
          <p>查看管理员审批意见：</p>
          <div class="table_two" style="float:left;margin-top:10px"></div>
      </div>
</div>
<script type="text/javascript">
       var able = false;
	   var isIE = /msie/i.test(navigator.userAgent) && !window.opera; 
	   function fileChange(target,id) { 
			var fileSize = 0; 
			var filetypes =[".xls",".xlsx"]; 
			var filepath = target.value; 
			var filemaxsize = 1024*2;//2M 
			if(filepath){ 
			var isnext = false; 
			var fileend = filepath.substring(filepath.indexOf(".")); 
			if(filetypes && filetypes.length>0){ 
				for(var i =0; i<filetypes.length;i++){ 
					if(filetypes[i]==fileend){ 
						isnext = true; 
						break; 
					} 
				} 
			} 
			if(!isnext){ 
				$.messager.alert("提示","不接受此文件类型！"); 
				target.value =""; 
				return false; 
			} 
			}else{ 
				return false; 
			} 
			if (isIE && !target.files) { 
				var filePath = target.value; 
				var fileSystem = new ActiveXObject("Scripting.FileSystemObject"); 
				if(!fileSystem.FileExists(filePath)){ 
					$.messager.alert("提示","文件不存在，请重新输入！"); 
					return false; 
				} 
				var file = fileSystem.GetFile (filePath); 
				fileSize = file.Size; 
			} else { 
				fileSize = target.files[0].size; 
			} 
			
			var size = fileSize / 1024; 
			if(size>filemaxsize){ 
				$.messager.alert("提示","文件大小不能大于"+filemaxsize/1024+"M！"); 
				target.value =""; 
				return false; 
			} 
			if(size<=0){ 
				$.messager.alert("提示","文件大小不能为0M！"); 
				target.value =""; 
				return false; 
			} 
			able=true;
	  } 
	  function check(){
	     if(able == true){
	       return true;
	     }
	     else{
	       $.messager.alert("提示","请选择文件");
	       return false;
	     }
	  }
	 /*   $('input[name="submit"]').click(function(){
	        if(able == true){
	            $.post('excel/addExcel.do',function(data){
	                 if(data.status==1){
				        $.messager.alert("提示","上传成功");
				     }else{
				        $.messager.alert("提示","上传失败");
			         }
	              });
	           }
	           else{
	             $.messager.alert("提示","请选择文件");
	             return false;
	          }
	       }); */
	   $(".table_two").datagrid({
				width:'750px',
				height:'330px',
				url:'excel/findExcelInfoByTecNum.do',
				rownumbers:'true',
				fitColumns:'true',
				striped:'true',//斑马线
				nowrap:'false',
				pagination:'true',
				columns : [ [
				           {field : 'academy',title : '学院',width : 200,align : 'center',
						        	formatter:function(value,row){
									 	return row.submitTeacher.academy.name;
									 }
						    },
						    {field : 'teacher',title : '上传教师',width : 200,align : 'center',
							          formatter:function(value,row){
					 	                    return row.submitTeacher.name;
					                  }
							},
				            {field : 'name',title : '上传文件名',width : 250,align : 'center'},
							{field : 'status',title : '审核',width : 100,align : 'center'}
				] ],
				onLoadError:function(){
					$.messager.alert("提示","载入远程数据出错！请刷新重试。","warning");

				},
				onLoadSuccess:function(data){
					if(data.rows.length==0){
						$.messager.alert("提示","没有符合条件的数据，请重新选择筛选条件","warning");
					}
				}
			}); 
</script>
