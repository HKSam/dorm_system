<style type="text/css"></style>
<div class="right_top btm">
  <div class="rheader"><span class="pageName"><b>添加楼栋</b></span><span class="shuoming">您可以按照模板添加新楼栋</span></div>
</div>
<div class="right_contain">
  <div class="addLodong">
    <form  id="add" action="../areaInfo/addBuildingByExcel.do" enctype="multipart/form-data" method="post">
      <span><b>请选择要上传文件：</b>
      <input type="file" name="file" onchange="fileChange(this)" >
      <input type="submit" value="上传" id="sub">
      </span>
    </form>
    <p><b>下载添加的楼栋信息模板：</b><a href="../Download/add_building_model.xlsx">excel模板下载</a></p>
    <p><img src="../images/add_loudong.jpg" /></p>
  </div>
</div>
<script type="text/javascript">
  //文件校验
	   var isIE = /msie/i.test(navigator.userAgent) && !window.opera; 
	   function fileChange(target,id) { 
			var fileSize = 0; 
			var filetypes =[".xls",".xlsx"]; 
			var filepath = target.value; 
			var filemaxsize = 1024*2;//2M 
			if(filepath){ 
			var isnext = false; 
			var fileend = filepath.substring(filepath.indexOf(".")); 
			if(filetypes && filetypes.length>0){ 
				for(var i =0; i<filetypes.length;i++){ 
					if(filetypes[i]==fileend){ 
						isnext = true; 
						break; 
					} 
				} 
			} 
			if(!isnext){ 
				$.messager.alert("提示","不接受此文件类型！"); 
				target.value =""; 
				return false; 
			} 
			}else{ 
				return false; 
			} 
			if (isIE && !target.files) { 
				var filePath = target.value; 
				var fileSystem = new ActiveXObject("Scripting.FileSystemObject"); 
				if(!fileSystem.FileExists(filePath)){ 
					$.messager.alert("提示","文件不存在，请重新输入！"); 
					return false; 
				} 
				var file = fileSystem.GetFile (filePath); 
				fileSize = file.Size; 
			} else { 
				fileSize = target.files[0].size; 
			} 
			
			var size = fileSize / 1024; 
			if(size>filemaxsize){ 
				$.messager.alert("提示","文件大小不能大于"+filemaxsize/1024+"M！"); 
				target.value =""; 
				return false; 
			} 
			if(size<=0){ 
				$.messager.alert("提示","文件大小不能为0M！"); 
				target.value =""; 
				return false; 
			} 
	  } 
		//添加excel文件检验
		$("#sub").click(function(){
			if(!$(this).prev('input').val()){
				$.messager.alert("提示","请选择要上传的Excel");
				return false;
			}else{
				return true;
			}
			
		});
$('#add').form({
  success:function(d){
  console.log(d);
  	var data=JSON.parse(d);
    if(data.status=='0'){
			$.messager.alert('操作提示',data.error,"info",function(){
			});		
		}else if(data.status=='1'){
			$.messager.alert('操作提示','上传成功',"info",function(){
				location.reload();
			});
			
		}
  }
});

</script>