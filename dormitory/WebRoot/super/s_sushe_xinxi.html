<div class="right_top btm">
  <div class="rheader"><span class="pageName"><b><span class="building"></span>栋住宿情况</b></span><span class="shuoming">您可以查看该栋的住宿情况并修改</span></div>
</div>
<div class="right_contain">
    <div id="tb"><!--tool bar-->
          <span>
                 <a href="javascript:void(0)" class="add">添加寝室</a>&nbsp;
                 <a href="javascript:void(0)" class="modify">修改寝室信息</a>&nbsp;
                 <a href="javascript:void(0)" class="delete">删除楼层</a>&nbsp;
          </span>
    </div>   
    <div id="dormitory"></div>
    <h5>提示：点击单元格可查看寝室入住人员信息,3/4表示该寝室可住4人，实住3人</h5>
</div> 
<script type="text/javascript">

$(".btm .rheader .pageName span.building").html(buildingid);
$(function(){
    $('#tb a:eq(0)').linkbutton({
		iconCls:'icon-add'
	});
	$('#tb a:eq(1)').linkbutton({
		iconCls:'icon-edit'
	});
	$('#tb a:eq(2)').linkbutton({
		iconCls:'icon-remove'
	});
	$.getJSON("json/get/s_sushe_xinxi.json",{"buildingid":buildingid},function(data){
		var options={
		data:data,
		width:'650px',
		height:'300px',				
		toolbar:'#tb',
		singleSelect:false,
		checkOnSelect:true,
		selectOnCheck: true,
		pagination:true,
		pageNumber:1,
		pageSize:5,
		pageList:[3,5,7],

		onClickCell:function(rowIndex, field, value){
			susheid=value.substring(0,6);
			if(susheid.indexOf("层")>=0){}
			else{
				contains=parseInt(value[12]);
				person=parseInt(value[10]);
				
				$("#base_right").empty().load("super/s_ruzhu_xinxi.html");
				}
		}
		}
		var s="[[";
		s+="{field:'ck',checkbox:true,rowspan:2},{field:'floorid',title:'楼层',width:50,align:'center',rowspan:2},";
		s+="{title:'寝室号',align:'center',colspan:"+data.columnmax+"}],[";
		for(i=1;i<data.columnmax;i++){
			s+="{field:'" +i+"',title:'"+i+"',width:'50',align:'center',styler:cellStyler},";
		}
		s+="{field:'" +data.columnmax+"',title:'"+data.columnmax+"',align:'center',styler:cellStyler}]]";
		
		options.columns=eval(s);
		options.nowrap=false;
	$('#dormitory').datagrid(options);
    $('#dormitory').datagrid('reload');
	});
	function cellStyler(value,row,index){
		if(value){
			
            if (value[10]< value[12]){
                return 'color:red;cursor:pointer';
            }
			return 'cursor:pointer';
		}
        }
	var pager = $('#dormitory').datagrid().datagrid('getPager');// get the pager of datagrid
	    pager.pagination({
		beforePageText:"第",
		afterPageText:"共{pages}页",
		displayMsg:"显示{from}到{to},共{total}条记录"
	    });
	$('.add').click(function(){	
		var checkedItems = $('#dormitory').datagrid('getChecked');
		//if(checkedItems)alert("请先选择楼层");
		var names = [];
   		$.each(checkedItems, function(index, item){
			names.push(item.floorid);
		
		});               
		if(names.length>1){
			 $.messager.alert("提示","单次操作只能添加一个寝室，请选择单个楼层","info");
			}else if(names.length==0){
				 $.messager.alert("提示","请先选择楼层","info");
				}else{
				  floorid=names[0];
				  action="add";
				  $("#base_right").empty().load("super/s_sushe_detail.html");
					}	
	});
	$('.modify').click(function(){	
		var checkedItems = $('#dormitory').datagrid('getChecked');
		var names = [];
   		$.each(checkedItems, function(index, item){
			names.push(item.floorid);
		
		});               
		if(names.length>1){
			 $.messager.alert("提示","请选择单个楼层","info");
			}else if(names.length==0){
				 $.messager.alert("提示","请先选择楼层","info");
				}else{
				  floorid=names[0];
				  action="modifyfloor";//修改整层宿舍信息
				  $("#base_right").empty().load("super/s_sushe_detail.html");
					}	
	});
		
	$('.delete').click(function(){	
		var checkedItems = $('#dormitory').datagrid('getSelections');	
		var floors = [];	
   		$.each(checkedItems, function(index, item){
			floors.push(item.floorid);
		});  
		$.post("json/post/s_delete_sushe.json",{"buildingid":buildingid,"floorid":floors});
		
		var rows=$('#dormitory').datagrid('getSelections');
		for(var i=0;i<rows.length;i++){
			var index = $('#dormitory').datagrid('getRowIndex',rows[i]);//获取某行的行号
		    $('#dormitory').datagrid('deleteRow',index);	//通过行号移除该行

		}
			           
		
	});
	
	
});
</script>