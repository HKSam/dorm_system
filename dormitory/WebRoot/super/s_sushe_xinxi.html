<style type="text/css">
h5{
	display:none;
}
</style>
<div class="right_top btm">
  <div class="rheader"><span class="pageName"><b><span class="building"></span>栋住宿情况</b></span><span class="shuoming">您可以查看该栋的住宿情况，寝室情况并修改</span></div>
</div>
<div class="right_contain">
    <div id="dormitory"></div>
    <h5>提示：点击单元格可查看寝室入住人员信息和修改宿舍信息,3/4表示该寝室可住4人，实住3人</h5>
</div> 
<script type="text/javascript">

$(".btm .rheader .pageName span.building").html(buildingid);
$(function(){
	/* $.post("json/get/s_sushe_xinxi.json",{"buildingid":buildingid},function(data){ */

	$.getJSON("roomInfo/findAllRoom.do",{"buildingNum":buildingid},function(data){
		var options={
		data:data,
		width:'880px',
		height:'360px',				
		toolbar:'#tb',
		singleSelect:false,
		checkOnSelect:true,
		selectOnCheck: true,
		striped:true,
		fitColumns:true,
		toolbar:[
			{
				id:'add',
				text:'添加寝室',
				iconCls:'icon-add',
				handler:add		
			},
			{
				id:'modifyBuilding',
				text:'修改楼栋信息',
				iconCls:'icon-edit',
				handler:modifyBuilding		
			},
			{
				id:'modify',
				text:'修改楼层信息',
				iconCls:'icon-edit',
				handler:modify	
			},
			{
				id:'delete',
				text:'删除楼层',
				iconCls:'icon-remove',
				handler:deleteRows
			}],
		/* pagination:true,
		pageNumber:1,
		pageSize:5,
		pageList:[3,5,7], */

		onClickCell:function(rowIndex, field, value){
			if(value){
				susheid=value.substring(0,6);
				var str= new Array(); //定义一数组
				str=value.split("/"); //字符分割 
				/* var p=str[1].indexOf("/"); */
				person=parseInt(str[1].substring(1,str[1].length));
				contains=parseInt(str[2]);
				$("#base_right").load("super/s_ruzhu_xinxi.html");
			
			}
			
		},//onCliclCell end
		onLoadSuccess:function(data){
			if(data.length==0){
				$.messager.alert("提示","没有符合条件的数据，请重新选择筛选条件","warning");
			}
			$('h5').show();
		},
		onLoadError:function(){
			$.messager.alert("error","errro","warning");
		}
		
		}//datagrid end
		var s="[[";
		s+="{field:'ck',checkbox:true,rowspan:2},{field:'item1',title:'楼层',width:50,align:'center',rowspan:2},";
		s+="{title:'寝室号',align:'center',colspan:"+data.columnMax+"}],[";
		for(i=2;i<data.columnMax;i++){
			s+="{field:'item" +i+"',title:'"+(i-1)+"',width:'50',align:'center',styler:cellStyler},";
		}
		s+="{field:'item" +data.columnMax+"',title:'"+(data.columnMax-1)+"',align:'center',styler:cellStyler}]]";
		options.columns=eval(s);
		options.nowrap=false;
	$('#dormitory').datagrid(options);
    $('#dormitory').datagrid('reload');
	});
	function cellStyler(value,row,index){
		if(value){
			
            if (value[11]< value[13]){
                return 'color:#666;cursor:pointer';
            }
			return 'cursor:pointer';
		}
    }
	/* var pager = $('#dormitory').datagrid().datagrid('getPager');// get the pager of datagrid
	    pager.pagination({
		beforePageText:"第",
		afterPageText:"共{pages}页",
		displayMsg:"显示{from}到{to},共{total}条记录"
	    }); */
	function add(){	
		var checkedItems = $('#dormitory').datagrid('getChecked');
		var names = [];
   		$.each(checkedItems, function(index, item){
			names.push(item.item1);
		
		});               
		if(names.length>1){
			 $.messager.alert("提示","单次操作只能添加一个寝室，请选择单个楼层","info");
			}else if(names.length==0){
				 $.messager.alert("提示","请先选择楼层","info");
				}else{
				  floorid=names[0];
				  action="add";
				  $("#base_right").empty().load("super/s_sushe_detail.html");
					}	
	}
	function modify(){	
		var checkedItems = $('#dormitory').datagrid('getChecked');
		var names = [];
   		$.each(checkedItems, function(index, item){
			names.push(item.item1);
		
		});               
		if(names.length>1){
			 $.messager.alert("提示","请选择单个楼层","info");
			}else if(names.length==0){
				 $.messager.alert("提示","请先选择楼层","info");
				}else{
				  floorid=names[0];
				  action="modifyfloor";//修改整层宿舍信息
				  $("#base_right").empty().load("super/s_sushe_detail.html");
					}	
	}
	function modifyBuilding	(){
		 $("#base_right").empty().load("super/s_modifybuilding.html");
	}
	function deleteRows(){
			var checkedItems = $('#dormitory').datagrid('getSelections');	
			var floors = [];
			var floorname="";	
   			$.each(checkedItems, function(index, item){
				floors.push(item.item1);
			});
			if(floors.length==0){
				$.messager.alert("提示","请先选择楼层","info");
			}else{
				$.messager.confirm("提示","确定删除所选内容么？",function(r){
					if(r){  
						$.post("roomInfo/delFloor.do",{"buildingNum":buildingid,"floorNum":floors},function(data){
							if(data.status==1){
								$.messager.alert("提示","删除成功","info");
								var rows=$('#dormitory').datagrid('getSelections');
								for(var i=0;i<rows.length;i++){
									var index = $('#dormitory').datagrid('getRowIndex',rows[i]);//获取某行的行号
				    				$('#dormitory').datagrid('deleteRow',index);
								}	//通过行号移除该行
							}else{
								$.messager.alert("提示","删除失败,删除的楼栋中有人在住,请先作退宿处理再删除","info");
								}
						});//post结束
					}
				});
			}
	}//delete end
	
	
});
</script>