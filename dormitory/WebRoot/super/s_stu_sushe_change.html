<style type="text/css">
.stuInfo h3 span {
	margin-right:15px;
	margin-left:10px;
	color:#69F;
}
 select {
	width:260px;
	margin-right:20px;
	margin-bottom:30px;
}
</style>
<div class="right_top btm">
  <div class="rheader"><span class="pageName"><b>寝室调换</b></span><span class="shuoming">您可以对选中的学生调换寝室</span><span class="fanhui"><a class="return" href="javascript:void(0)">返回»</a></span></div>
</div>
<div class="right_contain">
  <div class="stuInfo">
    <h3>您将要调换的学生学号：<span name="stuNum"></span>姓名:<span name="name"></span>性别:<span name="sex"></span></h3>
  </div>
  <form >
    片区<select class="area">
    	
    </select>
   楼栋 <select class="building">
    	
    </select>
    <input type="button" value="查询" />
  </form>
  <div class="empty"> </div>
</div>
<script type="text/javascript">
$(function(){
	$('.return').click(function(){
	 $("#base_right").empty().load("super/s_ruzhu_xinxi.html");
	})
	$('.stuInfo span[name="stuNum"]').append(stuNum);
	$('.stuInfo span[name="name"]').append(stuName);
	$('.stuInfo span[name="sex"]').append(stuSex);
	
	$.post("json/get/s_area.json",{"sex":stuSex},function(data){
		var area="<option value=''>请选择</option>";
		$.each(data.rows,function(index,item){
			 area+="<option value="+item.area+">"+item.area+"</option>";
		});
		$('.area').append(area);		
	});//post end
});//$(function() end
	
	$('.area').change(function(){
		var area=$('select option:selected').val();
		if(area!=''){
			$.post("json/get/s_buildingid.json",{"area":area,"sex":stuSex},function(data){
				var buildingid="<option value=''>请选择</option>";
				$.each(data.rows,function(index,item){
					buildingid+="<option value="+item.buildingid+">"+item.buildingid+"</option>";
				});
				$('.building').append(buildingid);
		    });	
		}	
	});
	$('input[type="button"]').click(function(){
		var area=$('.area').val();
		var name=$('.building').val();
		if(name!='' && area!=''){
			$.post("json/get/s_sushe_xinxi_empty.json",{"buildingid":name},function(data){
				var options={
					data:data,
					width:'1000px',
					height:'400px',				
					singleSelect:false,
					checkOnSelect:true,
					selectOnCheck: true,
					pagination:true	,
					nowrap:false,
					pageNumber:1,
					pageSize:5,
					pageList:[3,5,7],
			
					onClickCell:function(rowIndex, field, value){
						if(value){
							var per_susheid=susheid;
							susheid=value.substring(0,6);
							if(susheid.indexOf("层")>=0){}
							else{
								var str="确定将"+stuName+"同学调换到"+susheid+"寝吗？";
								$.messager.confirm('Confirm',str,function(r){
									if (r){
										$.post('json/post/s_delete_student.json',{"stuNum":stuNum,"susheid":susheid});
										susheid=per_susheid;
										$("#base_right").empty().load("super/s_ruzhu_xinxi.html");
									}
								});				
						   }
						}
						
					}//onClickCell end
					
				}//option end
				var s="[[";
				s+="{field:'floorid',title:'楼层',width:45,align:'center',rowspan:2},";
				s+="{title:'寝室号',align:'center',colspan:"+data.columnmax+"}],[";
				for(i=1;i<data.columnmax;i++){
					s+="{field:'" +i+"',title:'"+i+"',width:'48',align:'center',styler:cellStyler},";
				}
				s+="{field:'" +data.columnmax+"',title:'"+data.columnmax+"',width:'48',align:'center',styler:cellStyler}]]";
				options.columns=eval(s);
				$('.empty').datagrid(options);
				$('.empty').datagrid('reload');
			});//post end
		}else{
			$.messager.alert("提示","请选择片区和楼栋","info");
			}
	});		
	
	function cellStyler(value,row,index){
	  if(value){
		  if (value[10]< value[12]){
			  return 'color:red;cursor:pointer';
		  }
	  }

	}
</script>