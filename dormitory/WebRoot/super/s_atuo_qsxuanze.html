<style type="text/css">
.new_ldtxt {
	margin-bottom:30px;
}
</style>
<div class="sauto">
  <div class="new_ldtxt">请选择调换到的新楼栋：</div>
  <div class="xuanze_qinshi"></div>
  <br />
  <input type="button" name="sure_fenpei" value="确定" class="sure_fenpei" />
</div>
<script type="text/javascript">
	$(function(){
		var $jquery=$(".xuanze_qinshi");
		$jquery.bind("table_load",function(){//编写自定义事件
			//打开文件，通过回掉函数处理获取的数据
			//生成表1===
			$.getJSON("json/get/s_sushe_kong.json",{"sex":stuSex},function(data){			
				var html="<table>";
				$.each(data.rows,function(index,item){
				  html +="<tr><td class='area'>"+item["area"]+"</td>";
				  for(i=0;i<data.columnmax;i++){
					  if(item.buildingid[i]&&item.kong[i]){
						  html += "<td><input type='checkbox' name='checkbox_kong' class='checkbox_kong' value="+item.kong[i]+" />" +"<span class='buildingid'>"+item.buildingid[i]+"</span>" +"("+item.kong[i] +")"+"</td>";
					  }
					  else{
						  html += "<td></td>";
					  }
				  }
				  html += "</tr>";
				});
				html += "</table>";
				$(".xuanze_qinshi").html(html);	
				$(".sure_fenpei").show();	
			});	
		});
	$jquery.trigger("table_load");
	$(".sure_fenpei").click(function(){
		var buildingid={};
		var kong={};
		var i=0;
		$(".checkbox_kong").each(function(){
			if($(this).is(":checked")){ 
				var num = parseInt($(this).val());
				sum_dhstu_kong =parseInt(sum_dhstu_kong)+num; 
				buildingid[i]=parseInt($(this).parent().children(".buildingid").text());
				kong[i]=parseInt($(this).val());
				i++;
			}
	    });
		$.post('json/post/s_loudong_havexz.json',{"buildingid":buildingid,"kong":kong});
		//点击确定时会生成表格，不知道怎么写生成表格，把表格放在DOwnload文件夹里                
        if(sum_diaohuan==0){
		   $.messager.alert("警告","你还没有选择调换人员，无法分配！","warning"); 
	    }
	    else if(sum_dhstu_kong==0){
		   $.messager.alert("警告","你还没有选择空床位，无法分配！","warning"); 
		}
		else if(sum_dhstu_kong<sum_diaohuan){
		   $.messager.alert("提示","选择分配"+sum_diaohuan+"人，选择空床位"+sum_dhstu_kong+"个，无法分配！请点击确定重新选择！","info");
		}
		else if(sum_dhstu_kong>=sum_diaohuan){//弹框确认分配人数和空床位数的大小
		    	$.messager.confirm("提示:","选择分配"+sum_diaohuan+"人，选择空床位"+sum_dhstu_kong+"个，可以分配，将把自动分配结果发送给学院辅导员，请等待学院辅导员意见！",function(event){   
						if(event){   
							$("#base_right .right_contain").empty().load("super/s_fenpei_finish.html");
			                $(".editornav").removeAttr("class").parent().next().find("a").addClass("editornav");  
						}else{   
						  $.messager.alert("提示","请重新选择！");   
						}   
				    });   
		/*	$.messager.alert("提示","选择分配"+sum_diaohuan+"人，选择空床位"+sum_dhstu_kong+"个，可以分配，将把自动分配结果发送给学院辅导员，请等待学院辅导员意见！","info");
			$("#base_right .right_contain").empty().load("super/s_fenpei_finish.html");
			$(".editornav").removeAttr("class").parent().next().find("a").addClass("editornav");*/
			}
	});   
});
</script> 
